<!DOCTYPE html>
<html>
<head>
  <title>Live DHT11 Data</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAxbdsP6dcyTuorLv6VWY_ZJqiGd2n6Pt4",
      authDomain: "iot-esp-data.firebaseapp.com",
      databaseURL: "https://iot-esp-data-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iot-esp-data",
      storageBucket: "iot-esp-data.appspot.com",
      messagingSenderId: "683373734391",
      appId: "1:683373734391:web:34941228888b44eefe66f2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // âœ… Show latest data only
    const latestRef = query(ref(db, "sensor_logs"), limitToLast(1));
    onValue(latestRef, (snapshot) => {
      snapshot.forEach((child) => {
        document.getElementById("temp").innerText = child.val().temperature + " Â°C";
        document.getElementById("hum").innerText = child.val().humidity + " %";
        document.getElementById("time").innerText = child.val().date + " " + child.val().time;
      });
    });

    // âœ… Show full history latest-first
    const allRef = ref(db, "sensor_logs");
    onValue(allRef, (snapshot) => {
      let data = [];
      snapshot.forEach((child) => {
        data.push(child.val());
      });
      // Sort latest first by date+time
      data.sort((a, b) => (a.date + a.time < b.date + b.time ? 1 : -1));

      let tableHTML = "<tr><th>Date</th><th>Time</th><th>Temperature</th><th>Humidity</th></tr>";
      data.forEach(entry => {
        tableHTML += `<tr>
          <td>${entry.date}</td>
          <td>${entry.time}</td>
          <td>${entry.temperature} Â°C</td>
          <td>${entry.humidity} %</td>
        </tr>`;
      });
      document.getElementById("history").innerHTML = tableHTML;
    });
  </script>
</head>
<body>
  <h1>ðŸŒ¡ Live DHT11 Data</h1>
  <p><b>Temperature:</b> <span id="temp">--</span></p>
  <p><b>Humidity:</b> <span id="hum">--</span></p>
  <p><b>Last Updated:</b> <span id="time">--</span></p>

  <h2>ðŸ“œ Full History (Latest First)</h2>
  <table id="history"></table>
</body>
</html>
